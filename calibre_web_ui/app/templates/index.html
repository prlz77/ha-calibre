<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calibre Web UI</title>
    <!-- Bulma CSS for modern styling quickly -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f5f5f5; }
        .hero { background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%); }
        .book-card { height: 100%; transition: transform 0.2s; }
        .book-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .format-tag { cursor: pointer; }
    </style>
</head>
<body>

    <section class="hero is-info is-small">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">
                    <i class="fas fa-book-open"></i> Calibre Web Hub
                </h1>
                <h2 class="subtitle">
                    Local network reading and mangement
                </h2>
            </div>
        </div>
    </section>

    <div class="container section">

        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="notification is-{{ 'danger' if category == 'error' else category }} is-light">
                        <button class="delete"></button>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Upload Section -->
        <div class="box">
            <h3 class="title is-4">Add New Book</h3>
            <form action="{{ url_for('upload_book') }}" method="post" enctype="multipart/form-data">
                <div class="field has-addons">
                    <div class="control">
                        <div class="file has-name is-info">
                            <label class="file-label">
                                <input class="file-input" type="file" name="file" required onchange="document.getElementById('fileName').innerText = this.files[0].name;">
                                <span class="file-cta">
                                    <span class="file-icon"><i class="fas fa-upload"></i></span>
                                    <span class="file-label">Choose a fileâ€¦</span>
                                </span>
                                <span class="file-name" id="fileName">No file selected</span>
                            </label>
                        </div>
                    </div>
                    <div class="control">
                        <button type="submit" class="button is-info">Upload</button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Library Section -->
        <h3 class="title is-4 mt-6">Your Library</h3>
        <div class="columns is-multiline">
            {% for book in books %}
            <div class="column is-12-mobile is-6-tablet is-4-desktop">
                <div class="card book-card box">
                    <div class="card-content">
                        <div class="media">
                            <div class="media-content">
                                <p class="title is-5">{{ book.title }}</p>
                                <p class="subtitle is-6">by {{ book.authors }}</p>
                            </div>
                        </div>

                        <div class="content">
                            <p class="is-size-7 mb-2"><strong>Formats available:</strong></p>
                            <div class="tags">
                                {% for fmt_path in book.formats %}
                                    {% set fmt_ext = fmt_path.split('.')[-1] | upper %}
                                    <a href="{{ url_for('download_book', filepath=fmt_path) }}" class="tag is-primary is-light format-tag">
                                        {{ fmt_ext }} <i class="fas fa-download ml-1"></i>
                                    </a>
                                {% endfor %}
                            </div>

                            <hr>
                            <p class="is-size-7 mb-2"><strong>Convert to:</strong></p>
                            <form action="{{ url_for('convert_book', book_id=book.id) }}" method="post" class="is-flex" style="gap: 5px;">
                                <div class="select is-small">
                                    <select name="format">
                                        <option value="mobi">MOBI</option>
                                        <option value="azw3">AZW3</option>
                                        <option value="epub">EPUB</option>
                                        <option value="pdf">PDF</option>
                                    </select>
                                </div>
                                <button type="submit" class="button is-small is-link is-outlined">Convert</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="column is-12">
                <div class="notification is-warning is-light">
                    Your library is currently empty. Upload an EPUB or MOBI file to get started!
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Script for dismissible notifications -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            (document.querySelectorAll('.notification .delete') || []).forEach(($delete) => {
                const $notification = $delete.parentNode;
                $delete.addEventListener('click', () => {
                    $notification.parentNode.removeChild($notification);
                });
            });
        });
    </script>
</body>
</html>
